{"version":3,"file":null,"sources":["../src/component.js","../src/variable.js","../src/to-variable.js","../src/view-model.js"],"sourcesContent":["import { Observable } from 'rxjs/Observable'\nimport { Subscription } from 'rxjs/Subscription'\nimport h from 'virtual-dom/h'\nimport diff from 'virtual-dom/diff'\nimport patch from 'virtual-dom/patch'\nimport createElement from 'virtual-dom/create-element'\n\nimport 'element-closest'\nimport 'rxjs/add/observable/of'\nimport 'rxjs/add/observable/fromEvent'\nimport 'rxjs/add/operator/share'\n\nclass DOMComponent {\n  constructor(el) {\n    this.el = el\n    this.children = []\n    this.events = {}\n    this.subscription = new Subscription\n  }\n\n  addChild(child) {\n    this.children.push(child)\n    child.parent = this\n    child.didMoveToParent && child.didMoveToParent(this)\n  }\n\n  on(eventName, selector) {\n    if (!this.events[eventName]) {\n      this.events[eventName] = Observable.fromEvent(this.el, eventName).share()\n    }\n\n    if (selector) {\n      return this.events[eventName]\n        .filter(e => {\n          const el = e.target\n          if (typeof selector === 'string') {\n            return el.closest(selector)\n          } else {\n            return el === selector\n          }\n        })\n    } else {\n      return this.events[eventName]\n    }\n  }\n\n  dispose() {\n    for (let child of this.children) {\n      if (child.dispose) {\n        child.dispose()\n        child.parent = null\n      }\n    }\n    this.children = null\n\n    if (this.vm) {\n      this.vm.unsubscribe()\n      this.vm = null\n    }\n    this.subscription.unsubscribe()\n    this.subscription = null\n  }\n}\n\nclass VirtualDOMComponent extends DOMComponent {\n  bindDOM(bindElement) {\n    let tree = null\n    let node = null\n\n    this.renderSubscription = this.render()\n      .subscribe(newTree => {\n        if (tree) {\n          const patches = diff(tree, newTree)\n          node = patch(node, patches)\n          tree = newTree\n        } else {\n          tree = newTree\n          node = createElement(tree)\n          const el = bindElement || this.el\n          el.innerText = ''\n          el.appendChild(node)\n        }\n      })\n  }\n\n  unbindDOM() {\n    if (this.renderSubscriptino) {\n      this.renderSubscription.unsubscribe()\n      this.renderSubscription = null\n    }\n  }\n\n  render() {\n    return Observable.of(h('div'))\n  }\n\n  dispose() {\n    super.dispose()\n    this.unbindDOM()\n  }\n}\n\nexport { DOMComponent, VirtualDOMComponent }\n","import { BehaviorSubject } from 'rxjs/BehaviorSubject'\n\nclass Variable {\n  constructor(value, source) {\n    this.subject = new BehaviorSubject(value)\n    if (source) {\n      this.sourceDisposable = source.subscribe(v => this.value = v)\n    }\n  }\n\n  get value() {\n    return this.subject.value\n  }\n\n  set value(newValue) {\n    this.subject.next(newValue)\n  }\n\n  get isUnsubscribed() {\n    return this.subject.isUnsubscribed\n  }\n\n  get observable() {\n    return this.subject\n  }\n\n  next(value) {\n    this.subject.next(value)\n  }\n\n  error(error) {\n    this.subject.error(error)\n  }\n\n  complete() {\n    this.subject.complete()\n  }\n\n  unsubscribe() {\n    if (this.sourceDisposable) {\n      this.sourceDisposable.unsubscribe()\n    }\n    this.subject.complete()\n  }\n}\n\nexport default Variable\n","import { Observable } from 'rxjs/Observable'\nimport Variable from './variable'\n\nfunction toVariable(initialValue) {\n  return new Variable(initialValue, this)\n}\n\nObservable.prototype.toVariable = toVariable\n","import Variable from './variable'\nimport './to-variable'\n\nclass ViewModel {\n  constructor(attrs={}) {\n    this.keys = Object.keys(attrs)\n    for (let key of this.keys) {\n      this[key] = new Variable(attrs[key])\n    }\n  }\n\n  unsubscribe() {\n    for (let k in this) {\n      if (this.hasOwnProperty(k)) {\n        if (typeof this[k].dispose === 'function') {\n          this[k].unsubscribe()\n        }\n      }\n    }\n  }\n}\n\nexport default ViewModel\n"],"names":[],"mappings":"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"}
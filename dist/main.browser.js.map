{"version":3,"file":null,"sources":["../src/component.js","../src/variable.js","../src/to-variable.js","../src/view-model.js"],"sourcesContent":["import { Observable } from 'rxjs/Observable'\nimport { Subscription } from 'rxjs/Subscription'\nimport h from 'virtual-dom/h'\nimport diff from 'virtual-dom/diff'\nimport patch from 'virtual-dom/patch'\nimport createElement from 'virtual-dom/create-element'\n\nimport 'element-closest'\nimport 'rxjs/add/observable/of'\nimport 'rxjs/add/observable/fromEvent'\nimport 'rxjs/add/operator/share'\n\nclass DOMComponent {\n  constructor(el) {\n    this.el = el\n    this.children = []\n    this.events = {}\n    this.subscription = new Subscription\n  }\n\n  addChild(child) {\n    this.children.push(child)\n    child.parent = this\n    child.didMoveToParent && child.didMoveToParent(this)\n  }\n\n  on(eventName, selector) {\n    if (!this.events[eventName]) {\n      this.events[eventName] = Observable.fromEvent(this.el, eventName).share()\n    }\n\n    if (selector) {\n      return this.events[eventName]\n        .filter(e => {\n          const el = e.target\n          if (typeof selector === 'string') {\n            return el.closest(selector)\n          } else {\n            return el === selector\n          }\n        })\n    } else {\n      return this.events[eventName]\n    }\n  }\n\n  dispose() {\n    for (let child of this.children) {\n      if (child.dispose) {\n        child.dispose()\n        child.parent = null\n      }\n    }\n    this.children = null\n\n    if (this.vm) {\n      this.vm.unsubscribe()\n      this.vm = null\n    }\n    this.subscription.unsubscribe()\n    this.subscription = null\n  }\n}\n\nclass VirtualDOMComponent extends DOMComponent {\n  bindDOM(bindElement) {\n    let tree = null\n    let node = null\n\n    this.renderSubscription = this.render()\n      .subscribe(newTree => {\n        if (tree) {\n          const patches = diff(tree, newTree)\n          node = patch(node, patches)\n          tree = newTree\n        } else {\n          tree = newTree\n          node = createElement(tree)\n          const el = bindElement || this.el\n          el.innerText = ''\n          el.appendChild(node)\n        }\n      })\n  }\n\n  unbindDOM() {\n    if (this.renderSubscriptino) {\n      this.renderSubscription.unsubscribe()\n      this.renderSubscription = null\n    }\n  }\n\n  render() {\n    return Observable.of(h('div'))\n  }\n\n  dispose() {\n    super.dispose()\n    this.unbindDOM()\n  }\n}\n\nexport { DOMComponent, VirtualDOMComponent }\n","import { BehaviorSubject } from 'rxjs/BehaviorSubject'\n\nclass Variable {\n  constructor(value, source) {\n    this.subject = new BehaviorSubject(value)\n    if (source) {\n      this.sourceDisposable = source.subscribe(v => this.value = v)\n    }\n  }\n\n  get value() {\n    return this.subject.value\n  }\n\n  set value(newValue) {\n    this.subject.next(newValue)\n  }\n\n  get isUnsubscribed() {\n    return this.subject.isUnsubscribed\n  }\n\n  get observable() {\n    return this.subject\n  }\n\n  next(value) {\n    this.subject.next(value)\n  }\n\n  error(error) {\n    this.subject.error(error)\n  }\n\n  complete() {\n    this.subject.complete()\n  }\n\n  unsubscribe() {\n    if (this.sourceDisposable) {\n      this.sourceDisposable.unsubscribe()\n    }\n    this.subject.complete()\n  }\n}\n\nexport default Variable\n","import { Observable } from 'rxjs/Observable'\nimport Variable from './variable'\n\nfunction toVariable(initialValue) {\n  return new Variable(initialValue, this)\n}\n\nObservable.prototype.toVariable = toVariable\n","import Variable from './variable'\nimport './to-variable'\n\nclass ViewModel {\n  constructor(attrs={}) {\n    this.keys = Object.keys(attrs)\n    for (let key of this.keys) {\n      this[key] = new Variable(attrs[key])\n    }\n  }\n\n  unsubscribe() {\n    for (let k in this) {\n      if (this.hasOwnProperty(k)) {\n        if (typeof this[k].dispose === 'function') {\n          this[k].unsubscribe()\n        }\n      }\n    }\n  }\n}\n\nexport default ViewModel\n"],"names":["Subscription","Observable","BehaviorSubject"],"mappings":"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"}